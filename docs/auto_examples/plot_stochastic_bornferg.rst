.. note::
    :class: sphx-glr-download-link-note

    Click :ref:`here <sphx_glr_download_auto_examples_plot_stochastic_bornferg.py>` to download the full example code
.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_stochastic_bornferg.py:


================================
Stochastic Bornhuetter Ferguson
================================

There are several aspects of the chainladder module that are demonstrated with
this example.

1. We see how to use the `BootstrapODPSample` and `BornhuetterFerguson` to come
  up with a stochastic view of the Bornhuetter-Ferguson method.
2. We use the `broadcast_axis` method of the triangle class (new in 0.4.7)




.. image:: /auto_examples/images/sphx_glr_plot_stochastic_bornferg_001.png
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    <matplotlib.axes._subplots.AxesSubplot object at 0x000002204ECCDC18>





|


.. code-block:: default

    import chainladder as cl

    # Simulation parameters
    random_state = 42
    n_sims = 1000

    # Get data
    loss = cl.load_dataset('genins')
    premium = loss.latest_diagonal*0+8e6

    # Simulate loss triangles
    sim = cl.BootstrapODPSample(random_state=random_state, n_sims=n_sims)
    sim.fit(loss, sample_weight=premium)


    # Fit Bornhuetter-Ferguson to stochastically generated data
    model = cl.BornhuetterFerguson(0.65, apriori_sigma=0.10).fit(sim.resampled_triangles_, sample_weight=premium)

    # Grab completed triangle replacing simulated known data with actual known data
    full_triangle = model.full_triangle_ - model.X_ + loss.broadcast_axis('index', sim.resampled_triangles_.index)

    # Limiting to the current year for plotting
    current_year = full_triangle[full_triangle.origin==full_triangle.origin.max()].to_frame().T

    # Plot the data
    current_year.reset_index(drop=True).plot(
        color='orange', legend=False, alpha=0.1,
        title='Current Accident Year BornFerg Distribution', grid=True);


.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  11.573 seconds)


.. _sphx_glr_download_auto_examples_plot_stochastic_bornferg.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download

     :download:`Download Python source code: plot_stochastic_bornferg.py <plot_stochastic_bornferg.py>`



  .. container:: sphx-glr-download

     :download:`Download Jupyter notebook: plot_stochastic_bornferg.ipynb <plot_stochastic_bornferg.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
